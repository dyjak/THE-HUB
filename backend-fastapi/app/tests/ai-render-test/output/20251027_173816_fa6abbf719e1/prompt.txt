SYSTEM:
You are an AI music planner. Respond ONLY with valid minified JSON matching exactly this TypeScript schema: type Event={step:number,note:number,vel?:number,len?:number};type Layer={bar:number,events:Event[]};type SamplePref={instrument:string,subtype?:string,family?:string,tags?:string[],pitch?:string};type Output={midi:{style:string,mood:string,tempo:number,key:string,scale:string,meter:string,bars:number,length_seconds:number,form:string[],dynamic_profile:string,arrangement_density:string,harmonic_color:string,instruments:string[],instrument_configs?:unknown,seed?:number|null},layers:Record<string,Layer[]>,samples:SamplePref[],meta?:Record<string,unknown>};No markdown, no comments, no code fences. Every field must be JSON valid. Use 8 steps per bar (step 0-7); bars are 0-indexed. Keep note values 0-127.

USER:
Context:
- Requested style: ambient, mood: calm, tempo: 80 BPM, key: C, scale: major, meter: 4/4.
- Length target: 180.0s (~16 bars). Form (modifiable): intro | verse | chorus | bridge | outro.
- Available instruments: 808, bass_guitar, bass_synth, clap, flute, fx, hihat, kick, lead, misc, pad, piano, reese, snare, strings.
- Currently selected instruments: piano, pad, strings.
- Drum components available: 808, clap, hihat, kick, snare.
- FX subtypes: downfilter, impact, riser, subdrop, swell, upfilter.

Tasks:
1. Return a musical plan matching the schema. You may adjust tempo (±10 BPM) and bars (±4) if musically justified.
2. For each instrument in your layers, generate an array of bars. In each bar add zero or more events {step,note,vel,len}. Use quarter-note grid (8 steps per bar). Keep note values diatonic to the requested key/scale unless using tasteful chromatics.
3. Include samples: one entry per instrument in layers. Set subtype or family to help choose a local sample. Percussive instruments (kick/snare/hihat/clap/808/perc) must specify subtype. FX entries should set subtype (impact, riser, downfilter, upfilter, swell, subdrop).
4. If you use the virtual instrument "drums" replace it with concrete components. Do NOT return instruments outside the available list.
5. Avoid empty arrays. Remove instruments you do not use. Optionally place human-readable notes inside meta.notes.

Remember: Output must be a single minified JSON object.